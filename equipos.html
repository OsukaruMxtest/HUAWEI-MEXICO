<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equipos - PUBG MOBILE COPA HUAWEI MEXICO</title>
    <style>
        /* Importar fuente Poppins */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        /* Variables CSS para la nueva paleta de colores */
        :root {
            --primary: #BB0215;
            --primary-bright: #E9072B;
            --secondary: #00683F;
            --secondary-deep: #003F1E;
            --background: #C5C5C5;
            --glass: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(0, 0, 0, 0.1);
            --text: #000000;
            --text-secondary: #333333;
            --card-bg: rgba(255, 255, 255, 0.85);
            --shadow: rgba(0, 0, 0, 0.1);
        }
        
        /* Estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--background);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
            position: relative;
        }

        /* Video de fondo */
        .background-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            opacity: 0.3;
        }
        
        /* Header fijo */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
            z-index: 1000;
            padding: 1rem 2rem;
            box-shadow: 0 2px 15px var(--shadow);
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .nav-links {
            display: flex;
            gap: 1.5rem;
        }
        
        .nav-links a {
            color: var(--text);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            padding: 0.5rem 0;
        }
        
        .nav-links a:hover {
            color: var(--primary);
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary);
            transition: width 0.3s ease;
        }
        
        .nav-links a:hover::after {
            width: 100%;
        }
        
        /* Main content */
        main {
            margin-top: 80px;
            padding: 2rem;
        }
        
        /* Estilo glassmorphism moderno */
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 20px var(--shadow);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 1s ease forwards;
        }
        
        .slide-up {
            animation: slideUp 0.8s ease forwards;
        }
        
        /* Secciones */
        .section {
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text);
            border-left: 4px solid var(--primary);
            padding-left: 0.75rem;
        }
        
        /* Filtros y búsqueda */
        .filters-container {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .search-input {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: var(--text);
            font-family: 'Poppins', sans-serif;
            min-width: 300px;
            transition: all 0.3s ease;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(187, 2, 21, 0.2);
        }
        
        .compare-btn {
            background: var(--primary);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(187, 2, 21, 0.2);
        }
        
        .compare-btn:hover {
            background: var(--primary-bright);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(233, 7, 43, 0.25);
        }
        
        .compare-btn:disabled {
            background: #a0a0a0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Botones de grupo */
        .group-filters {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .group-btn {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            color: var(--text);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .group-btn:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }
        
        .group-btn.active {
            background: var(--secondary);
            border-color: var(--secondary);
            color: white;
        }
        
        /* Grid de equipos */
        .teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .team-card {
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .team-card.selected {
            border: 2px solid var(--primary);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .team-card.selectable:hover {
            transform: translateY(-5px);
        }
        
        .team-checkbox {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 20px;
            height: 20px;
            border: 2px solid var(--glass-border);
            border-radius: 4px;
            background: transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .team-card.selected .team-checkbox {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        .team-card.selected .team-checkbox::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 14px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .team-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .team-logo {
            width: 60px;
            height: 60px;
            border-radius: 5%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .team-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .team-info h3 {
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
            color: var(--text);
        }
        
        .team-info p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .team-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .team-stat {
            text-align: center;
            padding: 0.5rem;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.5);
        }
        
        .team-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .team-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .team-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            padding: 0.5rem;
            color: var(--text);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .action-btn:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-1px);
        }
        
        .action-btn.primary {
            background: var(--secondary);
            border-color: var(--secondary);
            color: white;
        }
        
        .action-btn.primary:hover {
            background: var(--secondary-deep);
            transform: translateY(-1px);
        }
        
        /* Modal de comparación */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 2rem;
        }
        
        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .modal {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            width: 100%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--glass-border);
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text);
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 5px;
            transition: background 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            background: rgba(0, 0, 0, 0.1);
        }
        
        /* Modal de detalles del equipo */
        .team-details-content {
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .team-details-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--glass-border);
        }
        
        .team-details-section:last-child {
            border-bottom: none;
        }
        
        .section-subtitle {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--secondary);
            border-left: 3px solid var(--secondary);
            padding-left: 0.5rem;
        }
        
        .team-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .team-detail-card {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .team-detail-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.1);
        }
        
        .team-detail-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }
        
        .team-detail-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .player-card {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .player-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.1);
        }
        
        .player-card.mvp {
            border: 2px solid var(--primary);
            background: rgba(187, 2, 21, 0.05);
        }
        
        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .player-name {
            font-weight: 600;
        }
        
        .mvp-badge {
            background: var(--primary);
            color: white;
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .player-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }
        
        .player-stat {
            text-align: center;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 4px;
            padding: 0.5rem;
        }
        
        .player-stat-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary);
        }
        
        .player-stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }
        
        .phases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        .phase-card {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .phase-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.1);
        }
        
        .phase-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--secondary);
        }
        
        .maps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .map-card {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 6px;
            padding: 0.5rem;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .map-card:hover {
            background: rgba(255, 255, 255, 0.9);
        }
        
        .map-name {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .map-stats {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }
        
        /* Nuevo diseño de comparación central */
        .central-comparison-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 2rem;
            align-items: start;
        }
        
        .comparison-team {
            text-align: center;
        }
        
        .comparison-team-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .comparison-logo {
            width: 80px;
            height: 80px;
            border-radius: 5%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .comparison-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .comparison-team-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text);
        }
        
        .comparison-metrics {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 5rem;
        }
        
        .metric-row {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .metric-row:hover {
            background: rgba(255, 255, 255, 0.9);
        }
        
        .metric-row.winner-left .metric-value-left {
            background: rgba(0, 104, 63, 0.2);
            border: 1px solid rgba(0, 104, 63, 0.5);
        }
        
        .metric-row.winner-right .metric-value-right {
            background: rgba(0, 104, 63, 0.2);
            border: 1px solid rgba(0, 104, 63, 0.5);
        }
        
        .metric-value {
            padding: 0.5rem;
            border-radius: 6px;
            font-weight: 600;
            text-align: center;
            color: var(--primary);
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }
        
        .metric-name {
            font-weight: 500;
            text-align: center;
            padding: 0.5rem;
            color: var(--text);
        }
        
        .vs-divider {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--primary);
            font-size: 1.2rem;
            margin: 1rem 0;
        }
        
        /* Footer */
        footer {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--glass-border);
            padding: 1.5rem 2rem;
            text-align: center;
            color: var(--text-secondary);
            margin-top: 2rem;
        }
        
        /* Scroll personalizado */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-deep);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .teams-grid {
                grid-template-columns: 1fr;
            }
            
            .filters-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-input {
                min-width: auto;
            }
            
            .central-comparison-container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .comparison-metrics {
                margin-top: 0;
                order: 3;
            }
            
            .modal {
                padding: 1rem;
            }
            
            .team-details-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .players-grid {
                grid-template-columns: 1fr;
            }
            
            .phases-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Estados de carga */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Video de fondo -->
    <video class="background-video" autoplay muted loop playsinline>
        <source src="https://res.cloudinary.com/dxtvsnw3g/video/upload/v1763772374/fondo_g1hfuz.mp4" type="video/mp4">
        Tu navegador no soporta videos HTML5.
    </video>
    
    <header>
        <nav>
            <div class="logo">PUBG MOBILE COPA HUAWEI MÉXICO</div>
            <div class="nav-links">
                <a href="index.html">Inicio</a>
				<a href="grupos.html">Grupos</a>
                <a href="fases.html">Fases</a>
                <a href="mvp-mvt.html">Tablas</a>
                <a href="equipos.html" style="color: var(--primary);">Equipos</a>
                <a href="jugadores.html">Jugadores</a>
                <a href="mapas.html">Mapas</a>
            </div>
        </nav>
    </header>
    
    <main>
        <div class="section fade-in">
            <h1 class="section-title">Equipos del Torneo</h1>
            <p>Visualiza y compara las estadísticas de todos los equipos participantes.</p>
        </div>
        
        <div class="section slide-up">
            <div class="filters-container">
                <input type="text" id="team-search" class="search-input" placeholder="Buscar equipo...">
                <button id="compare-btn" class="compare-btn" disabled>Comparar Equipos (0/2)</button>
            </div>
            
            <!-- Filtros por grupos -->
            <div class="group-filters" id="group-filters">
                <!-- Los botones de grupo se cargarán dinámicamente aquí -->
            </div>
            
            <div class="teams-grid" id="teams-grid">
                <!-- Las tarjetas de equipo se cargarán dinámicamente aquí -->
                <div class="loading">Cargando equipos...</div>
            </div>
        </div>
    </main>
    
    <!-- Modal de Comparación -->
    <div class="modal-overlay" id="comparison-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Comparación de Equipos</h2>
                <button class="close-btn" id="close-modal">&times;</button>
            </div>
            
            <div class="central-comparison-container" id="comparison-container">
                <!-- El contenido de comparación se cargará dinámicamente aquí -->
            </div>
        </div>
    </div>
    
    <!-- Modal de Detalles del Equipo -->
    <div class="modal-overlay" id="team-details-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="team-details-title">Detalles del Equipo</h2>
                <button class="close-btn" id="close-details-modal">&times;</button>
            </div>
            
            <div class="team-details-content" id="team-details-content">
                <!-- El contenido de detalles se cargará dinámicamente aquí -->
            </div>
        </div>
    </div>
    

    <script>
        // Variables globales para almacenar datos
        let allTeamsData = {};
        let selectedTeams = [];
        let currentGroup = null;
        let teamGroups = {};
        
        // Estructura de fases actualizada
        const phasesStructure = [
            { name: 'Clasificatorias', path: 'data/clasificatorias/', groups: ['GRUPO A', 'GRUPO B', 'GRUPO C', 'GRUPO D'], maps: ['M1', 'M2', 'M3', 'M4', 'M5', 'M6', 'M7', 'M8', 'M9'] },
            { name: 'Semifinal', path: 'data/semifinal/', groups: ['SEMIFINAL 1', 'SEMIFINAL 2'], maps: ['M1', 'M2', 'M3'] },
            { name: 'Final', path: 'data/final/', groups: ['FINAL'], maps: ['M1', 'M2', 'M3'] }
        ];
        
        // Mapeo de mapas
        const mapNames = {
            'M1': 'Erangel',
            'M2': 'Miramar', 
            'M3': 'Sanhok',
            'M4': 'Erangel',
            'M5': 'Miramar', 
            'M6': 'Sanhok',
            'M7': 'Erangel',
            'M8': 'Miramar', 
            'M9': 'Sanhok'
        };
        
        // Función para calcular puntos por posición
        function calculatePositionPoints(rank) {
            const pointsMap = { 1: 10, 2: 6, 3: 5, 4: 4, 5: 3, 6: 2, 7: 2, 8: 1 };
            return pointsMap[rank] || 0;
        }
        
        // Función para obtener la URL del logo del equipo
        function getTeamLogoUrl(teamName) {
            const basePath = 'data/logos/equipos/';
            const extensions = ['.png', '.jpg', '.jpeg', '.gif', '.bmp'];
            const normalizedTeamName = teamName.replace(/[^a-zA-Z0-9]/g, '_').toLowerCase();
            
            // Probar cada extensión
            for (const ext of extensions) {
                const logoPath = `${basePath}${normalizedTeamName}${ext}`;
                // En una implementación real, podríamos verificar si el archivo existe
                // Por ahora, asumimos que existe si el equipo tiene datos
                if (allTeamsData[teamName]) {
                    return logoPath;
                }
            }
            
            // Si no se encuentra, usar logo por defecto
            return `${basePath}default.png`;
        }
        
        // Función para obtener la fase actual basada en el grupo
        function getCurrentPhase() {
            if (currentGroup.startsWith('GRUPO')) {
                return 'Clasificatorias';
            } else if (currentGroup.startsWith('SEMIFINAL')) {
                return 'Semifinal';
            } else if (currentGroup === 'FINAL') {
                return 'Final';
            }
            return 'GENERAL';
        }
        
        // Función para cargar y procesar datos CSV
        async function loadTeamsData() {
            try {
                // Cargar datos de todas las fases
                for (const phase of phasesStructure) {
                    for (const group of phase.groups) {
                        for (const map of phase.maps) {
                            const csvPath = `${phase.path}${group}/${map}.csv`;
                            await loadCSVFile(csvPath, phase.name, group, map);
                        }
                    }
                }
                
                // Procesar datos acumulados
                processTeamsData();
                
                // Actualizar la UI
                updateGroupFilters();
                updateTeamsGrid();
                
                // Configurar event listeners
                setupEventListeners();
                
            } catch (error) {
                console.error('Error cargando datos:', error);
                document.getElementById('teams-grid').innerHTML = '<div class="loading">Error cargando datos de equipos</div>';
            }
        }
        
        // Función para cargar un archivo CSV individual
        async function loadCSVFile(filePath, phase, group, map) {
            try {
                const response = await fetch(filePath + "?nocache=" + Date.now());
                if (!response.ok) {
                    // Si el archivo no existe, simplemente continuamos
                    return;
                }
                
                const csvText = await response.text();
                const lines = csvText.split('\n');
                
                // Obtener encabezados (primera línea)
                const headers = lines[0].split(',');

                // Crear un mapa para rastrear la mejor posición por equipo en esta partida
                const teamBestRank = {};
                const teamWWCD = {};
                
                // Procesar cada línea de datos
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim() === '') continue;
                    
                    const values = lines[i].split(',');
                    const playerData = {};
                    
                    // Mapear valores a encabezados
                    headers.forEach((header, index) => {
                        playerData[header.trim()] = values[index] ? values[index].trim() : '';
                    });
                    
                    // Convertir valores numéricos
                    playerData.kills = parseInt(playerData['Número de Bajas']) || 0;
                    playerData.damage = parseFloat(playerData['Daño']) || 0;
                    playerData.headshots = parseInt(playerData['Número de Headshots']) || 0;
                    playerData.assists = parseInt(playerData['Asistencias']) || 0;
                    playerData.rank = parseInt(playerData['Rango']) || 0;
                    playerData.maxKillDistance = parseFloat(playerData['Máxima Distancia de Baja']) || 0;
                    playerData.survivalTime = parseFloat(playerData['Tiempo de Supervivencia']) || 0;
                    playerData.accuracy = parseFloat(playerData['Accuracy(%)']) || 0;
                    playerData.totalShots = parseInt(playerData['TotalShots']) || 0;
                    playerData.totalHits = parseInt(playerData['TotalHits']) || 0;
                    playerData.headHits = parseInt(playerData['HeadHits']) || 0;
                    playerData.bodyHits = parseInt(playerData['BodyHits']) || 0;
                    playerData.handHits = parseInt(playerData['HandHits']) || 0;
                    playerData.footHits = parseInt(playerData['FootHits']) || 0;
                    playerData.limbsHits = parseInt(playerData['LimbsHits']) || 0;
                    playerData.weaponKills = parseInt(playerData['WeaponKills']) || 0;
                    
                    // Agregar información de fase, grupo y mapa
                    playerData.phase = phase;
                    playerData.group = group;
                    playerData.map = map;
                    playerData.mapName = mapNames[map] || map;
                    
                    // Procesar datos del equipo
                    const teamName = playerData['Nombre del Equipo'];
                    if (!allTeamsData[teamName]) {
                        allTeamsData[teamName] = {
                            name: teamName,
                            players: {},
                            kills: 0,
                            damage: 0,
                            headshots: 0,
                            wwcd: 0,
                            matches: new Set(),
                            maps: {},
                            phases: {},
                            bestRank: 99,
                            lastMatchRank: 0,
                            totalAssists: 0,
                            totalSurvivalTime: 0,
                            totalMaxKillDistance: 0,
                            totalGrenadeKills: 0,
                            totalDistanceDriven: 0,
                            totalDistanceTraveled: 0,
                            totalRevives: 0,
                            groups: new Set(),
                            // Nuevos campos para manejar posición y puntos por partida
                            matchPoints: 0,
                            matchPositions: {},
                            // Datos por fase
                            phaseData: {}
                        };
                    }
                    
                    // Inicializar datos de fase si no existen
                    if (!allTeamsData[teamName].phaseData[phase]) {
                        allTeamsData[teamName].phaseData[phase] = {
                            kills: 0,
                            damage: 0,
                            headshots: 0,
                            wwcd: 0,
                            matches: new Set(),
                            points: 0,
                            bestRank: 99,
                            players: {},
                            maps: {},
                            totalAssists: 0,
                            totalSurvivalTime: 0,
                            totalMaxKillDistance: 0,
                            totalGrenadeKills: 0,
                            totalDistanceDriven: 0,
                            totalDistanceTraveled: 0,
                            totalRevives: 0
                        };
                    }
                    
                    // Actualizar estadísticas del equipo (siempre sumar kills, daño, etc.)
                    allTeamsData[teamName].kills += playerData.kills;
                    allTeamsData[teamName].damage += playerData.damage;
                    allTeamsData[teamName].headshots += playerData.headshots;
                    allTeamsData[teamName].totalAssists += playerData.assists;
                    allTeamsData[teamName].totalSurvivalTime += playerData.survivalTime;
                    allTeamsData[teamName].totalMaxKillDistance = Math.max(
                        allTeamsData[teamName].totalMaxKillDistance, 
                        playerData.maxKillDistance
                    );
                    allTeamsData[teamName].totalGrenadeKills += parseInt(playerData['Bajas con Granada']) || 0;
                    allTeamsData[teamName].totalDistanceDriven += parseFloat(playerData['Distancia Conducida']) || 0;
                    allTeamsData[teamName].totalDistanceTraveled += parseFloat(playerData['Distancia Recorrida']) || 0;
                    allTeamsData[teamName].totalRevives += parseInt(playerData['Rescates']) || 0;
                    
                    // Actualizar estadísticas por fase
                    allTeamsData[teamName].phaseData[phase].kills += playerData.kills;
                    allTeamsData[teamName].phaseData[phase].damage += playerData.damage;
                    allTeamsData[teamName].phaseData[phase].headshots += playerData.headshots;
                    allTeamsData[teamName].phaseData[phase].totalAssists += playerData.assists;
                    allTeamsData[teamName].phaseData[phase].totalSurvivalTime += playerData.survivalTime;
                    allTeamsData[teamName].phaseData[phase].totalMaxKillDistance = Math.max(
                        allTeamsData[teamName].phaseData[phase].totalMaxKillDistance, 
                        playerData.maxKillDistance
                    );
                    allTeamsData[teamName].phaseData[phase].totalGrenadeKills += parseInt(playerData['Bajas con Granada']) || 0;
                    allTeamsData[teamName].phaseData[phase].totalDistanceDriven += parseFloat(playerData['Distancia Conducida']) || 0;
                    allTeamsData[teamName].phaseData[phase].totalDistanceTraveled += parseFloat(playerData['Distancia Recorrida']) || 0;
                    allTeamsData[teamName].phaseData[phase].totalRevives += parseInt(playerData['Rescates']) || 0;
                    
                    // Registrar el grupo del equipo
                    allTeamsData[teamName].groups.add(group);
                    
                    const matchId = `${phase}-${group}-${map}`;
                    allTeamsData[teamName].matches.add(matchId);
                    allTeamsData[teamName].phaseData[phase].matches.add(matchId);
                    
                    // Rastrear la mejor posición del equipo en esta partida
                    if (!teamBestRank[teamName] || playerData.rank < teamBestRank[teamName]) {
                        teamBestRank[teamName] = playerData.rank;
                    }
                    
                    // Rastrear si el equipo ganó esta partida
                    if (playerData.rank === 1) {
                        teamWWCD[teamName] = true;
                    }
                    
                    // Mejor posición global
                    if (playerData.rank < allTeamsData[teamName].bestRank) {
                        allTeamsData[teamName].bestRank = playerData.rank;
                    }
                    
                    // Mejor posición por fase
                    if (playerData.rank < allTeamsData[teamName].phaseData[phase].bestRank) {
                        allTeamsData[teamName].phaseData[phase].bestRank = playerData.rank;
                    }
                    
                    // Última posición (asumimos que el último CSV es la última partida)
                    allTeamsData[teamName].lastMatchRank = playerData.rank;
                    
                    // Actualizar datos por mapa
                    if (!allTeamsData[teamName].maps[playerData.mapName]) {
                        allTeamsData[teamName].maps[playerData.mapName] = {
                            kills: 0,
                            damage: 0
                        };
                    }
                    allTeamsData[teamName].maps[playerData.mapName].kills += playerData.kills;
                    allTeamsData[teamName].maps[playerData.mapName].damage += playerData.damage;
                    
                    // Actualizar datos por mapa en la fase
                    if (!allTeamsData[teamName].phaseData[phase].maps[playerData.mapName]) {
                        allTeamsData[teamName].phaseData[phase].maps[playerData.mapName] = {
                            kills: 0,
                            damage: 0
                        };
                    }
                    allTeamsData[teamName].phaseData[phase].maps[playerData.mapName].kills += playerData.kills;
                    allTeamsData[teamName].phaseData[phase].maps[playerData.mapName].damage += playerData.damage;
                    
                    // Actualizar datos por fase
                    if (!allTeamsData[teamName].phases[phase]) {
                        allTeamsData[teamName].phases[phase] = {
                            kills: 0,
                            damage: 0
                        };
                    }
                    allTeamsData[teamName].phases[phase].kills += playerData.kills;
                    allTeamsData[teamName].phases[phase].damage += playerData.damage;
                    
                    // Agrupar datos por jugador en el equipo
                    const playerName = playerData['Nombre del Jugador'];
                    if (!allTeamsData[teamName].players[playerName]) {
                        allTeamsData[teamName].players[playerName] = {
                            name: playerName,
                            kills: 0,
                            damage: 0,
                            headshots: 0,
                            assists: 0
                        };
                    }
                    allTeamsData[teamName].players[playerName].kills += playerData.kills;
                    allTeamsData[teamName].players[playerName].damage += playerData.damage;
                    allTeamsData[teamName].players[playerName].headshots += playerData.headshots;
                    allTeamsData[teamName].players[playerName].assists += playerData.assists;
                    
                    // Agrupar datos por jugador en la fase
                    if (!allTeamsData[teamName].phaseData[phase].players[playerName]) {
                        allTeamsData[teamName].phaseData[phase].players[playerName] = {
                            name: playerName,
                            kills: 0,
                            damage: 0,
                            headshots: 0,
                            assists: 0
                        };
                    }
                    allTeamsData[teamName].phaseData[phase].players[playerName].kills += playerData.kills;
                    allTeamsData[teamName].phaseData[phase].players[playerName].damage += playerData.damage;
                    allTeamsData[teamName].phaseData[phase].players[playerName].headshots += playerData.headshots;
                    allTeamsData[teamName].phaseData[phase].players[playerName].assists += playerData.assists;
                }
                
                // Después de procesar toda la partida, asignar WWCD y puntos de posición
                Object.keys(teamBestRank).forEach(teamName => {
                    // Asignar WWCD si el equipo ganó esta partida
                    if (teamWWCD[teamName]) {
                        allTeamsData[teamName].wwcd += 1;
                        allTeamsData[teamName].phaseData[phase].wwcd += 1;
                    }
                    
                    // Calcular y asignar puntos por posición
                    const positionPoints = calculatePositionPoints(teamBestRank[teamName]);
                    allTeamsData[teamName].matchPoints += positionPoints;
                    allTeamsData[teamName].phaseData[phase].points += positionPoints;
                    
                    // Guardar posición para esta partida
                    const matchId = `${phase}-${group}-${map}`;
                    if (!allTeamsData[teamName].matchPositions[matchId]) {
                        allTeamsData[teamName].matchPositions[matchId] = teamBestRank[teamName];
                    }
                });
                
            } catch (error) {
                console.warn(`No se pudo cargar ${filePath}:`, error);
            }
        }
        
        // Procesar datos de equipos
        function processTeamsData() {
            // Calcular puntos para cada equipo (puntos por posición + 1 punto por kill)
            Object.values(allTeamsData).forEach(team => {
                team.points = team.matchPoints + team.kills;
                team.matchCount = team.matches.size;
                
                // Calcular puntos por fase
                Object.keys(team.phaseData).forEach(phase => {
                    team.phaseData[phase].totalPoints = team.phaseData[phase].points + team.phaseData[phase].kills;
                    team.phaseData[phase].matchCount = team.phaseData[phase].matches.size;
                    
                    // Encontrar MVP del equipo por fase
                    team.phaseData[phase].mvp = Object.values(team.phaseData[phase].players).reduce((best, player) => {
                        return !best || player.kills > best.kills ? player : best;
                    }, null);
                    
                    // Calcular porcentajes del MVP por fase
                    if (team.phaseData[phase].mvp) {
                        team.phaseData[phase].mvp.killPercentage = (team.phaseData[phase].mvp.kills / team.phaseData[phase].kills * 100).toFixed(1);
                        team.phaseData[phase].mvp.damagePercentage = (team.phaseData[phase].mvp.damage / team.phaseData[phase].damage * 100).toFixed(1);
                    }
                    
                    // Encontrar mapa con más kills y daño por fase
                    team.phaseData[phase].bestKillsMap = Object.entries(team.phaseData[phase].maps).reduce((best, [map, stats]) => {
                        return !best || stats.kills > best.kills ? { map, ...stats } : best;
                    }, null);
                    
                    team.phaseData[phase].bestDamageMap = Object.entries(team.phaseData[phase].maps).reduce((best, [map, stats]) => {
                        return !best || stats.damage > best.damage ? { map, ...stats } : best;
                    }, null);
                });
                
                // Encontrar mapa con más kills y daño global
                team.bestKillsMap = Object.entries(team.maps).reduce((best, [map, stats]) => {
                    return !best || stats.kills > best.kills ? { map, ...stats } : best;
                }, null);
                
                team.bestDamageMap = Object.entries(team.maps).reduce((best, [map, stats]) => {
                    return !best || stats.damage > best.damage ? { map, ...stats } : best;
                }, null);
                
                // Encontrar MVP del equipo global
                team.mvp = Object.values(team.players).reduce((best, player) => {
                    return !best || player.kills > best.kills ? player : best;
                }, null);
                
                // Calcular porcentajes del MVP global
                if (team.mvp) {
                    team.mvp.killPercentage = (team.mvp.kills / team.kills * 100).toFixed(1);
                    team.mvp.damagePercentage = (team.mvp.damage / team.damage * 100).toFixed(1);
                }
            });
            
            // Preparar grupos para filtrado
            prepareTeamGroups();
        }
        
        // Preparar datos de grupos para filtrado
        function prepareTeamGroups() {
            teamGroups = {};
            
            // Recopilar todos los grupos únicos en el orden especificado
            const groupOrder = ['GENERAL', 'GRUPO A', 'GRUPO B', 'GRUPO C', 'GRUPO D', 'SEMIFINAL 1', 'SEMIFINAL 2', 'FINAL'];
            
            // Para GENERAL, incluir todos los equipos
            teamGroups['GENERAL'] = Object.keys(allTeamsData);
            
            // Para cada grupo específico, incluir solo equipos de ese grupo
            groupOrder.forEach(group => {
                if (group !== 'GENERAL') {
                    teamGroups[group] = Object.keys(allTeamsData).filter(teamName => 
                        allTeamsData[teamName].groups.has(group)
                    );
                }
            });
            
            // Establecer el grupo actual como GENERAL
            currentGroup = 'GENERAL';
        }
        
        // Actualizar filtros de grupo
        function updateGroupFilters() {
            const groupFilters = document.getElementById('group-filters');
            
            // Orden de grupos especificado
            const groupOrder = ['GENERAL', 'GRUPO A', 'GRUPO B', 'GRUPO C', 'GRUPO D', 'SEMIFINAL 1', 'SEMIFINAL 2', 'FINAL'];
            
            // Filtrar solo grupos que tienen equipos
            const availableGroups = groupOrder.filter(group => 
                teamGroups[group] && teamGroups[group].length > 0
            );
            
            if (availableGroups.length === 0) {
                return;
            }
            
            groupFilters.innerHTML = '';
            
            availableGroups.forEach(group => {
                const groupBtn = document.createElement('button');
                groupBtn.className = `group-btn ${group === currentGroup ? 'active' : ''}`;
                groupBtn.textContent = group;
                groupBtn.dataset.group = group;
                
                groupBtn.addEventListener('click', () => {
                    // Actualizar grupo activo
                    document.querySelectorAll('.group-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    groupBtn.classList.add('active');
                    
                    // Filtrar equipos
                    currentGroup = group;
                    updateTeamsGrid();
                });
                
                groupFilters.appendChild(groupBtn);
            });
        }
        
        // Actualizar grid de equipos
        function updateTeamsGrid() {
            const teamsGrid = document.getElementById('teams-grid');
            
            if (Object.keys(allTeamsData).length === 0) {
                teamsGrid.innerHTML = '<div class="loading">No se encontraron datos de equipos</div>';
                return;
            }
            
            // Filtrar equipos por grupo actual
            let teamsToShow;
            if (currentGroup && teamGroups[currentGroup]) {
                teamsToShow = teamGroups[currentGroup].map(teamName => {
                    const team = allTeamsData[teamName];
                    
                    // Si no es GENERAL, usar datos específicos de la fase
                    if (currentGroup !== 'GENERAL') {
                        // Encontrar la fase correspondiente al grupo actual
                        let phaseForGroup = '';
                        if (currentGroup.startsWith('GRUPO')) {
                            phaseForGroup = 'Clasificatorias';
                        } else if (currentGroup.startsWith('SEMIFINAL')) {
                            phaseForGroup = 'Semifinal';
                        } else if (currentGroup === 'FINAL') {
                            phaseForGroup = 'Final';
                        }
                        
                        // Si tenemos datos para esta fase, crear un objeto temporal con esos datos
                        if (phaseForGroup && team.phaseData[phaseForGroup]) {
                            const phaseData = team.phaseData[phaseForGroup];
                            return {
                                ...team,
                                // Sobrescribir con datos de la fase específica
                                kills: phaseData.kills,
                                damage: phaseData.damage,
                                headshots: phaseData.headshots,
                                wwcd: phaseData.wwcd,
                                points: phaseData.totalPoints,
                                matchCount: phaseData.matchCount,
                                bestRank: phaseData.bestRank,
                                // Marcador para saber que estamos en modo fase específica
                                isPhaseSpecific: true,
                                phaseName: phaseForGroup
                            };
                        }
                    }
                    
                    // Para GENERAL o si no hay datos específicos, usar datos globales
                    return {
                        ...team,
                        isPhaseSpecific: false
                    };
                });
            } else {
                teamsToShow = Object.values(allTeamsData).map(team => ({
                    ...team,
                    isPhaseSpecific: false
                }));
            }
            
            // Ordenar por puntos (descendente)
            teamsToShow.sort((a, b) => b.points - a.points);
            
            teamsGrid.innerHTML = '';
            
            teamsToShow.forEach(team => {
                const teamCard = document.createElement('div');
                teamCard.className = `glass-card team-card selectable ${selectedTeams.includes(team.name) ? 'selected' : ''}`;
                teamCard.dataset.team = team.name;
                
                teamCard.innerHTML = `
                    <div class="team-checkbox"></div>
                    <div class="team-header">
                        <div class="team-logo">
                            <img src="${getTeamLogoUrl(team.name)}" alt="${team.name}" onerror="this.src='data/logos/equipos/default.png'">
                        </div>
                        <div class="team-info">
                            <h3>${team.name}</h3>
                            <p>${team.matchCount} partidas</p>
                            ${team.isPhaseSpecific ? `<small>${team.phaseName}</small>` : ''}
                        </div>
                    </div>
                    <div class="team-stats">
                        <div class="team-stat">
                            <div class="team-stat-value">${team.points}</div>
                            <div class="team-stat-label">Puntos</div>
                        </div>
                        <div class="team-stat">
                            <div class="team-stat-value">${team.wwcd}</div>
                            <div class="team-stat-label">WWCD</div>
                        </div>
                        <div class="team-stat">
                            <div class="team-stat-value">${team.kills}</div>
                            <div class="team-stat-label">Bajas</div>
                        </div>
                        <div class="team-stat">
                            <div class="team-stat-value">${Math.round(team.damage)}</div>
                            <div class="team-stat-label">Daño</div>
                        </div>
                    </div>
                    <div class="team-actions">
                        <button class="action-btn" data-action="details">Ver Detalles</button>
                        <button class="action-btn primary" data-action="select">Seleccionar</button>
                    </div>
                `;
                
                teamsGrid.appendChild(teamCard);
            });
        }
        
        // Configurar event listeners
        function setupEventListeners() {
            // Búsqueda de equipos
            document.getElementById('team-search').addEventListener('input', filterTeams);
            
            // Botón de comparar
            document.getElementById('compare-btn').addEventListener('click', showComparisonModal);
            
            // Cerrar modales
            document.getElementById('close-modal').addEventListener('click', closeComparisonModal);
            document.getElementById('close-details-modal').addEventListener('click', closeTeamDetailsModal);
            
            // Cerrar modales al hacer clic fuera
            document.getElementById('comparison-modal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    closeComparisonModal();
                }
            });
            
            document.getElementById('team-details-modal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    closeTeamDetailsModal();
                }
            });
            
            // Event delegation para las tarjetas de equipo
            document.getElementById('teams-grid').addEventListener('click', (e) => {
                const teamCard = e.target.closest('.team-card');
                if (!teamCard) return;
                
                const teamName = teamCard.dataset.team;
                const action = e.target.dataset.action;
                
                if (action === 'select' || e.target.classList.contains('team-checkbox')) {
                    toggleTeamSelection(teamName, teamCard);
                } else if (action === 'details' || e.target.closest('.team-card') === teamCard) {
                    showTeamDetailsModal(teamName);
                }
            });
        }
        
        // Filtrar equipos
        function filterTeams() {
            const searchTerm = document.getElementById('team-search').value.toLowerCase();
            
            document.querySelectorAll('.team-card').forEach(card => {
                const teamName = card.querySelector('h3').textContent.toLowerCase();
                card.style.display = teamName.includes(searchTerm) ? '' : 'none';
            });
        }
        
        // Alternar selección de equipo
        function toggleTeamSelection(teamName, teamCard) {
            const index = selectedTeams.indexOf(teamName);
            
            if (index === -1) {
                // Si ya hay 2 equipos seleccionados, quitar el primero
                if (selectedTeams.length >= 2) {
                    const firstTeam = selectedTeams[0];
                    const firstCard = document.querySelector(`[data-team="${firstTeam}"]`);
                    if (firstCard) {
                        firstCard.classList.remove('selected');
                    }
                    selectedTeams.shift();
                }
                
                // Agregar el nuevo equipo
                selectedTeams.push(teamName);
                teamCard.classList.add('selected');
            } else {
                // Quitar el equipo
                selectedTeams.splice(index, 1);
                teamCard.classList.remove('selected');
            }
            
            // Actualizar botón de comparar
            updateCompareButton();
        }
        
        // Actualizar botón de comparar
        function updateCompareButton() {
            const compareBtn = document.getElementById('compare-btn');
            const count = selectedTeams.length;
            
            compareBtn.textContent = `Comparar Equipos (${count}/2)`;
            compareBtn.disabled = count !== 2;
        }
        
        // Mostrar modal de comparación
        function showComparisonModal() {
            if (selectedTeams.length !== 2) return;
            
            const modal = document.getElementById('comparison-modal');
            const container = document.getElementById('comparison-container');
            
            // Obtener datos de los equipos seleccionados
            const team1 = allTeamsData[selectedTeams[0]];
            const team2 = allTeamsData[selectedTeams[1]];
            
            // Generar contenido de comparación con nueva estructura
            container.innerHTML = `
                <div class="comparison-team">
                    <div class="comparison-team-header">
                        <div class="comparison-logo">
                            <img src="${getTeamLogoUrl(team1.name)}" alt="${team1.name}" onerror="this.src='data/logos/equipos/default.png'">
                        </div>
                        <h3 class="comparison-team-name">${team1.name}</h3>
                    </div>
                </div>
                
                <div class="comparison-metrics" id="comparison-metrics">
                    <!-- Las métricas se cargarán dinámicamente aquí -->
                </div>
                
                <div class="comparison-team">
                    <div class="comparison-team-header">
                        <div class="comparison-logo">
                            <img src="${getTeamLogoUrl(team2.name)}" alt="${team2.name}" onerror="this.src='data/logos/equipos/default.png'">
                        </div>
                        <h3 class="comparison-team-name">${team2.name}</h3>
                    </div>
                </div>
            `;
            
            // Llenar estadísticas de comparación
            fillComparisonStats(team1, team2);
            
            // Mostrar modal
            modal.classList.add('active');
        }
        
        // Llenar estadísticas de comparación con nuevo diseño
        function fillComparisonStats(team1, team2) {
            const metricsContainer = document.getElementById('comparison-metrics');
            
            // Definir estadísticas a comparar (sin Tiempo de Supervivencia)
            const comparisonStats = [
                { name: 'Puntos Totales', key: 'points', formatter: (v) => v },
                { name: 'WWCD', key: 'wwcd', formatter: (v) => v },
                { name: 'Bajas Totales', key: 'kills', formatter: (v) => v },
                { name: 'Daño Total', key: 'damage', formatter: (v) => Math.round(v) },
                { name: 'Headshots', key: 'headshots', formatter: (v) => v },
                { name: 'Asistencias', key: 'totalAssists', formatter: (v) => v },
                { name: 'Partidas Jugadas', key: 'matchCount', formatter: (v) => v },
                { name: 'Mejor Posición', key: 'bestRank', formatter: (v) => v === 99 ? 'N/A' : v },
                { name: 'Posición Última Partida', key: 'lastMatchRank', formatter: (v) => v },
                { name: 'Eliminación Más Lejana (m)', key: 'totalMaxKillDistance', formatter: (v) => Math.round(v) },
                { name: 'Bajas con Granada', key: 'totalGrenadeKills', formatter: (v) => v },
                { name: 'Distancia Conducida (m)', key: 'totalDistanceDriven', formatter: (v) => Math.round(v) },
                { name: 'Distancia Recorrida (m)', key: 'totalDistanceTraveled', formatter: (v) => Math.round(v) },
                { name: 'Rescates', key: 'totalRevives', formatter: (v) => v }
            ];
            
            metricsContainer.innerHTML = '';
            
            comparisonStats.forEach(stat => {
                const value1 = team1[stat.key];
                const value2 = team2[stat.key];
                
                // Determinar qué equipo gana en esta estadística
                let winnerClass = '';
                
                if (typeof value1 === 'number' && typeof value2 === 'number') {
                    // Para la mayoría de estadísticas, mayor es mejor
                    if (stat.key === 'bestRank' || stat.key === 'lastMatchRank') {
                        // Para posiciones, menor es mejor
                        if (value1 < value2) {
                            winnerClass = 'winner-left';
                        } else if (value2 < value1) {
                            winnerClass = 'winner-right';
                        }
                    } else {
                        if (value1 > value2) {
                            winnerClass = 'winner-left';
                        } else if (value2 > value1) {
                            winnerClass = 'winner-right';
                        }
                    }
                }
                
                const metricRow = document.createElement('div');
                metricRow.className = `metric-row ${winnerClass}`;
                metricRow.innerHTML = `
                    <div class="metric-value metric-value-left">${stat.formatter(value1)}</div>
                    <div class="metric-name">${stat.name}</div>
                    <div class="metric-value metric-value-right">${stat.formatter(value2)}</div>
                `;
                
                metricsContainer.appendChild(metricRow);
            });
        }
        
        // Cerrar modal de comparación
        function closeComparisonModal() {
            document.getElementById('comparison-modal').classList.remove('active');
        }
        
        // Mostrar modal de detalles del equipo
        function showTeamDetailsModal(teamName) {
            const modal = document.getElementById('team-details-modal');
            const title = document.getElementById('team-details-title');
            const content = document.getElementById('team-details-content');
            
            const team = allTeamsData[teamName];
            if (!team) return;
            
            // Actualizar título
            title.textContent = `Detalles de ${team.name}`;
            
            // Generar contenido del modal basado en la fase actual
            content.innerHTML = generateTeamDetailsContent(team);
            
            // Mostrar modal
            modal.classList.add('active');
        }
        
        // Generar contenido de detalles del equipo basado en la fase actual
        function generateTeamDetailsContent(team) {
            const currentPhase = getCurrentPhase();
            
            // Si estamos en GENERAL, mostrar datos acumulados
            if (currentGroup === 'GENERAL') {
                return generateGeneralTeamDetails(team);
            } 
            // Si estamos en una fase específica, mostrar datos de esa fase
            else {
                return generatePhaseSpecificTeamDetails(team, currentPhase);
            }
        }
        
        // Generar detalles del equipo para GENERAL (datos acumulados)
        function generateGeneralTeamDetails(team) {
            // Obtener grupos como string
            const groups = Array.from(team.groups).join(', ');
            
            // Obtener fases como string
            const phases = Object.keys(team.phases).join(', ');
            
            return `
                <div class="team-details-section">
                    <h3 class="section-subtitle">Datos Generales (Acumulados)</h3>
                    <div class="team-details-grid">
                        <div class="team-detail-card">
                            <div class="team-detail-value">${team.matchCount}</div>
                            <div class="team-detail-label">Partidas Jugadas</div>
                        </div>
                        <div class="team-detail-card">
                            <div class="team-detail-value">${team.points}</div>
                            <div class="team-detail-label">Puntos</div>
                        </div>
                        <div class="team-detail-card">
                            <div class="team-detail-value">${team.kills}</div>
                            <div class="team-detail-label">Bajas</div>
                        </div>
                        <div class="team-detail-card">
                            <div class="team-detail-value">${Math.round(team.damage)}</div>
                            <div class="team-detail-label">Daño</div>
                        </div>
                        <div class="team-detail-card">
                            <div class="team-detail-value">${team.wwcd}</div>
                            <div class="team-detail-label">WWCD</div>
                        </div>
                        <div class="team-detail-card">
                            <div class="team-detail-value">${team.bestRank === 99 ? 'N/A' : team.bestRank}</div>
                            <div class="team-detail-label">Mejor Posición</div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <p><strong>Fases:</strong> ${phases}</p>
                        <p><strong>Grupos:</strong> ${groups}</p>
                    </div>
                </div>
                
                <div class="team-details-section">
                    <h3 class="section-subtitle">Desempeño por Fase</h3>
                    <div class="team-details-grid">
                        ${Object.entries(team.phaseData).map(([phase, phaseStats]) => `
                            <div class="team-detail-card">
                                <div class="team-detail-value">${phaseStats.totalPoints}</div>
                                <div class="team-detail-label">${phase}</div>
                                <div style="font-size: 0.9rem; margin-top: 0.25rem;">
                                    ${phaseStats.kills} bajas, ${phaseStats.wwcd} WWCD
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="team-details-section">
                    <h3 class="section-subtitle">Desempeño por Mapa</h3>
                    <div class="team-details-grid">
                        <div class="team-detail-card">
                            <div class="team-detail-value">${team.bestKillsMap ? team.bestKillsMap.map : 'N/A'}</div>
                            <div class="team-detail-label">Mejor Mapa por Bajas</div>
                            <div style="font-size: 0.9rem; margin-top: 0.25rem;">${team.bestKillsMap ? team.bestKillsMap.kills + ' bajas' : ''}</div>
                        </div>
                        <div class="team-detail-card">
                            <div class="team-detail-value">${team.bestDamageMap ? team.bestDamageMap.map : 'N/A'}</div>
                            <div class="team-detail-label">Mejor Mapa por Daño</div>
                            <div style="font-size: 0.9rem; margin-top: 0.25rem;">${team.bestDamageMap ? Math.round(team.bestDamageMap.damage) + ' daño' : ''}</div>
                        </div>
                    </div>
                </div>
                
                <div class="team-details-section">
                    <h3 class="section-subtitle">Jugadores</h3>
                    <div class="players-grid">
                        ${Object.values(team.players).map(player => `
                            <div class="player-card ${team.mvp && player.name === team.mvp.name ? 'mvp' : ''}">
                                <div class="player-header">
                                    <div class="player-name">${player.name}</div>
                                    ${team.mvp && player.name === team.mvp.name ? '<div class="mvp-badge">MVP</div>' : ''}
                                </div>
                                <div class="player-stats">
                                    <div class="player-stat">
                                        <div class="player-stat-value">${player.kills}</div>
                                        <div class="player-stat-label">Bajas</div>
                                    </div>
                                    <div class="player-stat">
                                        <div class="player-stat-value">${Math.round(player.damage)}</div>
                                        <div class="player-stat-label">Daño</div>
                                    </div>
                                    <div class="player-stat">
                                        <div class="player-stat-value">${player.headshots}</div>
                                        <div class="player-stat-label">Headshots</div>
                                    </div>
                                    <div class="player-stat">
                                        <div class="player-stat-value">${player.assists}</div>
                                        <div class="player-stat-label">Asistencias</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                ${team.mvp ? `
                <div class="team-details-section">
                    <h3 class="section-subtitle">Aporte del MVP</h3>
                    <div class="team-details-grid">
                        <div class="team-detail-card">
                            <div class="team-detail-value">${team.mvp.killPercentage}%</div>
                            <div class="team-detail-label">Porcentaje de Bajas</div>
                            <div style="font-size: 0.9rem; margin-top: 0.25rem;">${team.mvp.kills} de ${team.kills} bajas</div>
                        </div>
                        <div class="team-detail-card">
                            <div class="team-detail-value">${team.mvp.damagePercentage}%</div>
                            <div class="team-detail-label">Porcentaje de Daño</div>
                            <div style="font-size: 0.9rem; margin-top: 0.25rem;">${Math.round(team.mvp.damage)} de ${Math.round(team.damage)} daño</div>
                        </div>
                    </div>
                </div>
                ` : ''}
            `;
        }
        
        // Generar detalles del equipo para una fase específica
        function generatePhaseSpecificTeamDetails(team, phase) {
            const phaseData = team.phaseData[phase];
            
            if (!phaseData) {
                return `<div class="loading">No hay datos para este equipo en ${phase}</div>`;
            }
            
            // Obtener grupos en esta fase específica
            const groupsInPhase = Array.from(team.groups).filter(group => {
                if (phase === 'Clasificatorias') {
                    return group.startsWith('GRUPO');
                } else if (phase === 'Semifinal') {
                    return group.startsWith('SEMIFINAL');
                } else if (phase === 'Final') {
                    return group === 'FINAL';
                }
                return false;
            }).join(', ');
            
            return `
                <div class="team-details-section">
                    <h3 class="section-subtitle">Datos en ${phase}</h3>
                    <div class="team-details-grid">
                        <div class="team-detail-card">
                            <div class="team-detail-value">${phaseData.matchCount}</div>
                            <div class="team-detail-label">Partidas Jugadas</div>
                        </div>
                        <div class="team-detail-card">
                            <div class="team-detail-value">${phaseData.totalPoints}</div>
                            <div class="team-detail-label">Puntos</div>
                        </div>
                        <div class="team-detail-card">
                            <div class="team-detail-value">${phaseData.kills}</div>
                            <div class="team-detail-label">Bajas</div>
                        </div>
                        <div class="team-detail-card">
                            <div class="team-detail-value">${Math.round(phaseData.damage)}</div>
                            <div class="team-detail-label">Daño</div>
                        </div>
                        <div class="team-detail-card">
                            <div class="team-detail-value">${phaseData.wwcd}</div>
                            <div class="team-detail-label">WWCD</div>
                        </div>
                        <div class="team-detail-card">
                            <div class="team-detail-value">${phaseData.bestRank === 99 ? 'N/A' : phaseData.bestRank}</div>
                            <div class="team-detail-label">Mejor Posición</div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <p><strong>Grupos en ${phase}:</strong> ${groupsInPhase}</p>
                    </div>
                </div>
                
                <div class="team-details-section">
                    <h3 class="section-subtitle">Desempeño por Mapa en ${phase}</h3>
                    <div class="team-details-grid">
                        <div class="team-detail-card">
                            <div class="team-detail-value">${phaseData.bestKillsMap ? phaseData.bestKillsMap.map : 'N/A'}</div>
                            <div class="team-detail-label">Mejor Mapa por Bajas</div>
                            <div style="font-size: 0.9rem; margin-top: 0.25rem;">${phaseData.bestKillsMap ? phaseData.bestKillsMap.kills + ' bajas' : ''}</div>
                        </div>
                        <div class="team-detail-card">
                            <div class="team-detail-value">${phaseData.bestDamageMap ? phaseData.bestDamageMap.map : 'N/A'}</div>
                            <div class="team-detail-label">Mejor Mapa por Daño</div>
                            <div style="font-size: 0.9rem; margin-top: 0.25rem;">${phaseData.bestDamageMap ? Math.round(phaseData.bestDamageMap.damage) + ' daño' : ''}</div>
                        </div>
                    </div>
                </div>
                
                <div class="team-details-section">
                    <h3 class="section-subtitle">Jugadores en ${phase}</h3>
                    <div class="players-grid">
                        ${Object.values(phaseData.players).map(player => `
                            <div class="player-card ${phaseData.mvp && player.name === phaseData.mvp.name ? 'mvp' : ''}">
                                <div class="player-header">
                                    <div class="player-name">${player.name}</div>
                                    ${phaseData.mvp && player.name === phaseData.mvp.name ? '<div class="mvp-badge">MVP</div>' : ''}
                                </div>
                                <div class="player-stats">
                                    <div class="player-stat">
                                        <div class="player-stat-value">${player.kills}</div>
                                        <div class="player-stat-label">Bajas</div>
                                    </div>
                                    <div class="player-stat">
                                        <div class="player-stat-value">${Math.round(player.damage)}</div>
                                        <div class="player-stat-label">Daño</div>
                                    </div>
                                    <div class="player-stat">
                                        <div class="player-stat-value">${player.headshots}</div>
                                        <div class="player-stat-label">Headshots</div>
                                    </div>
                                    <div class="player-stat">
                                        <div class="player-stat-value">${player.assists}</div>
                                        <div class="player-stat-label">Asistencias</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                ${phaseData.mvp ? `
                <div class="team-details-section">
                    <h3 class="section-subtitle">Aporte del MVP en ${phase}</h3>
                    <div class="team-details-grid">
                        <div class="team-detail-card">
                            <div class="team-detail-value">${phaseData.mvp.killPercentage}%</div>
                            <div class="team-detail-label">Porcentaje de Bajas</div>
                            <div style="font-size: 0.9rem; margin-top: 0.25rem;">${phaseData.mvp.kills} de ${phaseData.kills} bajas</div>
                        </div>
                        <div class="team-detail-card">
                            <div class="team-detail-value">${phaseData.mvp.damagePercentage}%</div>
                            <div class="team-detail-label">Porcentaje de Daño</div>
                            <div style="font-size: 0.9rem; margin-top: 0.25rem;">${Math.round(phaseData.mvp.damage)} de ${Math.round(phaseData.damage)} daño</div>
                        </div>
                    </div>
                </div>
                ` : ''}
            `;
        }
        
        // Cerrar modal de detalles del equipo
        function closeTeamDetailsModal() {
            document.getElementById('team-details-modal').classList.remove('active');
        }
        
        // Inicializar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', () => {
            // Cargar datos
            loadTeamsData();
        });
    </script>
</body>
</html>
